public static class ServiceCollectionExtensions
{
    /// <summary>
    /// Registers PolicyCacheOptions, MemoryCache, TimeProvider, and PortalPolicyService.
    /// Call this once in Program.cs during startup.
    /// </summary>
    public static IServiceCollection AddPortalPolicyServices(this IServiceCollection services, IConfiguration config)
    {
        services.Configure<PolicyCacheOptions>(config.GetSection("Auth:PolicyCache"));
        services.AddMemoryCache();

        // TimeProvider.System is fine; register if not already
        services.AddSingleton<TimeProvider>(TimeProvider.System);

        services.AddScoped<IPortalPolicyService, PortalPolicyService>();
        return services;
    }
}


