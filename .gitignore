import React from "react";
import { toastForbidden } from "../../utils/toast";

/**
 * A button that blocks clicks when not allowed and shows a toast instead.
 * By default it is *not* disabled so users get feedback; set `disableWhenBlocked` to true if you
 * prefer the native disabled state (no click).
 */
export default function GuardedButton({
  allowed,
  onClick,
  blockMessage = "You donâ€™t have permission to perform this action.",
  disableWhenBlocked = false,
  children,
  ...rest
}) {
  const handleClick = (e) => {
    if (!allowed) {
      e.preventDefault();
      toastForbidden(blockMessage);
      return;
    }
    onClick?.(e);
  };

  return (
    <button
      {...rest}
      onClick={handleClick}
      aria-disabled={!allowed}
      disabled={disableWhenBlocked && !allowed}
      style={!allowed && !disableWhenBlocked ? { opacity: 0.9, cursor: "not-allowed" } : undefined}
      title={!allowed ? blockMessage : rest.title}
    >
      {children}
    </button>
  );
}
