import api from '../../../lib/axiosClient';

/**
 * Save completion state for an org + CSF2 subcategory.
 * action: 'Complete' | 'Reopen'
 * note: optional string
 * Returns the updated header fields so UI can patch immediately.
 */
export async function saveSubcatCompletion({ orgID, csF2SubcategoryID, action, note }) {
  const { data } = await api.post('/api/v1/CSFAttributeMap/subcat/completion/save', {
    orgID,
    csF2SubcategoryID,
    action,
    note: note ?? null,
  });
  // Expecting server to return these fields. Fallbacks keep UI responsive.
  return {
    completedByName:  data?.completedByName  ?? null,
    completedAt:      data?.completedAt      ?? (action === 'Complete' ? new Date().toISOString() : null),
    reopenedByName:   data?.reopenedByName   ?? (action === 'Reopen' ? (data?.actorName || null) : null),
    reopenedAt:       data?.reopenedAt       ?? (action === 'Reopen'   ? new Date().toISOString() : null),
  };
}
