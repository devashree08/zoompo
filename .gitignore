import * as React from 'react';
import { Card, CardContent, Typography, List, ListItem, ListItemText } from '@mui/material';

/** Dedupes rows into unique CSF 1.1 subcats (ignores ID=0 customs). */
export default function AssociatedCsf11Panel({ rows = [] }) {
  const items = React.useMemo(() => {
    const map = new Map();
    rows.forEach(r => {
      if (!r.csF1SubcategoryID || r.csF1SubcategoryID === 0) return;
      if (!map.has(r.csF1SubcategoryID)) {
        map.set(r.csF1SubcategoryID, {
          id: r.csF1SubcategoryID,
          name: r.csF1SubcategoryName,
          language: r.csF1SubcategoryLanguage
        });
      }
    });
    return Array.from(map.values());
  }, [rows]);

  return (
    <Card variant="outlined">
      <CardContent>
        <Typography variant="overline" color="text.secondary">Associated 1.1 Subcategories</Typography>
        {items.length === 0 ? (
          <Typography variant="body2" sx={{ mt: 1 }}>None â€” new in CSF 2.0.</Typography>
        ) : (
          <List dense>
            {items.map(it => (
              <ListItem key={it.id} disableGutters sx={{ alignItems: 'flex-start' }}>
                <ListItemText
                  primary={<Typography variant="body2" sx={{ fontWeight: 600 }}>{it.name}</Typography>}
                  secondary={it.language ? <Typography variant="caption" color="text.secondary">{it.language}</Typography> : null}
                />
              </ListItem>
            ))}
          </List>
        )}
      </CardContent>
    </Card>
  );
}
