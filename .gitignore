import { buildAttributeWorkbook } from '../export/buildAttributeWorkbook';
import { saveWorkbook } from '../../../ui/data/xlsx/excel';
import { fetchAttributeFeed, fetchAttributeFilterLookups } from '../api/attributeApi';

async function handleExportAll() {
  // 1) Get every org so we always create one sheet per org
  const lookups = await fetchAttributeFilterLookups({});
  const orgs = (lookups.orgs || []).map(o => ({ orgID: o.orgID, orgName: o.orgName }));

  // 2) Pull the full feed (no subcat limiting; you can also drop other filters if you want truly global)
  const feed = await fetchAttributeFeed({
    functionIds: [], categoryIds: [], subcatIds: [], ownerNames: [], custodianNames: [],
    maturity: [], finalOnly: false, search: ''
  });

  const wb = await buildAttributeWorkbook({
    rows: feed.rows || [],
    orgs, // ensures every org gets a sheet
  });

  await saveWorkbook(wb, 'csf-attribute-mapping.xlsx');
}
